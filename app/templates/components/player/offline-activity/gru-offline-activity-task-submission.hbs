<div class="task-submission-container">
  <div class="task-summary-container">
    <div class="task-icon">
    </div>
    <div class="task-info">
      <div class="task-title">
        {{task.title}}
      </div>
      <div class="pending-submission">
        {{#each typeBasedMandatoryUploads as |mandatoryUpload index|}}
          <span>{{mandatoryUpload.pendingCount}} {{mandatoryUpload.type}}</span>
          {{#if (lt (plus-one index) typeBasedMandatoryUploads.length ) }}
            |
          {{/if}}
        {{/each}}
      </div>
    </div>
    <div class="task-description">
      {{task.description}}
    </div>
    {{#unless isReadOnly}}
      {{#if (or pendingUploadSubmissions pendingUrlSubmissions)}}
        <div class="pending-submission-info">
          <div class="pending-label-container">{{t 'oa.pending-submissions'}}:</div>
          <div class="pending-info-container">
            {{#if pendingUploadSubmissions}}
              <span class="pending-info">{{pendingUploadSubmissions}} {{t 'oa.references.uploads'}}</span>
            {{/if}}
            {{#if pendingUrlSubmissions}}
              |
              <span class="pending-info">{{pendingUrlSubmissions}} URLs</span>
            {{/if}}
          </div>
        </div>
      {{/if}}
    {{/unless}}
    {{#if showToggle}}
      <div class="task-toggle" {{action "onToggleTask"}}>
        {{#if isTaskExpanded}}
          {{gru-icon name="expand_less"}}
        {{else}}
          {{gru-icon name="expand_more"}}
        {{/if}}
      </div>
    {{/if}}
  </div>
  <div class="task-details-container">
    {{#if showSubmissions}}
      <div class="task-upload-container">
        <div class="task-answer">
          <div class="answer-label">
            {{t 'your-answer'}}
          </div>
          {{#if isReadOnly}}
            <p>{{task.submissionText}}</p>
          {{else}}
            <div class="input-container">
              {{gru-rich-text-editor isCustomEditor=true content=task.submissionText isAutoFocusDisabled="true"}}
            </div>
          {{/if}}
        </div>
        <div class="task-file-upload-container">
          {{#each studentTaskUploadSubmission as |file|}}
            <div class="task-file-preview" data-toggle="tooltip">
              <a href="{{file.submissionInfo}}" target="_blank" class="preview-file-link">
                {{#if (eq file.submissionSubtype 'image')}}
                  <img src="{{file.submissionInfo}}" />
                {{else}}
                  {{#if file.submissionIcon}}
                    <i class="fa {{file.submissionIcon}}"></i>
                  {{else}}
                    {{gru-icon name="insert_drive_file"}}
                  {{/if}}
                {{/if}}
              </a>
            </div>
          {{/each}}
          {{#unless isReadOnly}}
            {{#each listOfFilesUploads as |file index|}}
              <div class="task-file-upload">
                {{#file-picker dropzone=false errors=fileUploadErrors fileLoaded="onUploadFile" readAs="readAsFile" removePreview=file.isRemovePreview onRemoveFile=removeFile}}

                  {{!-- A DIV is used instead of a BUTTON because the button's click default behaviour
                  may cause unwanted side-effects if this component is placed in a modal
                   (i.e. clicking on this button will cause the modal to close) --}}
                  <div class="file-upload-box">
                    {{gru-icon name="add"}}
                  </div>

                {{/file-picker}}
                {{#if file.isFileAvailable}}
                  <div class="file-upload-actions">
                    <div class="remove-file" {{action "onRemoveFile" index}}>{{gru-icon name="clear"}}</div>
                  </div>
                {{/if}}
              </div>
            {{/each}}
          {{/unless}}
        </div>
        <div class="task-url-upload-container">
          {{#each task.urls as |taskUrl index|}}
            <div class="task-url-upload {{if taskUrl.isSubmittedUrl 'preview-url'}}">
              {{#if taskUrl.isSubmittedUrl}}
                <span class="url-label">URL {{plus-one index}}: </span>
                <a class="url-link" href="{{taskUrl.value}}" target="_blank">{{taskUrl.value}}</a>
              {{else if (not isReadOnly)}}
                <span class="url-label">URL {{plus-one index}}: </span>
                <span class="url-value">{{input type="text" value=taskUrl.value}}</span>
              {{/if}}
              {{#unless isReadOnly}}
                {{#if (eq task.urls.length (plus-one index))}}
                  <div class="add-url" {{action "onAppendUrl"}}>
                    {{gru-icon name="add_circle"}}
                  </div>
                {{/if}}
              {{/unless}}
            </div>
          {{/each}}
        </div>
        {{#unless isReadOnly}}
          <div class="save-task-submission {{unless isEnableTaskSubmission 'disable-event'}} {{if isSubmittingTask 'saving'}}" {{action "onSaveTask"}}>
            {{#if isSubmittingTask}}
              {{t 'common.saving'}}<span class="spinner">{{three-bounce-spinner}}</span>
            {{else}}
              {{t 'common.save'}}
            {{/if}}
          </div>
        {{/unless}}
      </div>
    {{/if}}
  </div>
</div>
